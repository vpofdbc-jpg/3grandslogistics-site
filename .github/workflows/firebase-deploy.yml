name: Firebase Hosting Deploy (Live)

on:
  push:
    branches:
      - main 

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        
      # === Setup Environment and Build Steps (Necessary for Web App) ===
      - name: Setup Node.js Environment
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Using v20 as per remote for modern compatibility
          cache: 'npm' # Use npm cache for faster installs
        
      - name: Install Project Dependencies
        # Must run npm ci to install all dependencies before building
        run: npm ci
        
      - name: Build Project (npm run build)
        # This step runs the build script defined in your package.json
        run: npm run build
      # ================================================================
        
      - name: Deploy to Firebase Hosting Live Channel
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          # Using the specific project ID and service account from the remote branch
          firebaseServiceAccount: '${{ secrets.GCP_SA_KEY }}'
          projectId: grandslogistics-8af41
          channelId: live # Deploys to your primary site URL (live)
          target: customer-app-mobile # Deploying to the specific target hosting site